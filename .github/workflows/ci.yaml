deploy:
  needs: build
  runs-on: ubuntu-latest
  if: github.ref == 'refs/heads/main'

  steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: 🛠️ Setup kubeconfig
      run: |
        mkdir -p $HOME/.kube
        echo "${{ secrets.KUBE_CONFIG }}" | base64 -d > $HOME/.kube/config

    - name: Deploy to Kubernetes
      run: |
        kubectl apply -f ./k8s/ingress.yaml
        kubectl apply -f ./k8s/namespace.yaml
        kubectl apply -f ./frontend/k8s/
        kubectl apply -f ./backend/k8s/
